<!doctype html>
<html lang="pt">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Offline Photo Album</title>
<style>
:root{
  --bg:#0f1115; --card:#0b0d10; --muted:#9aa0a6; --accent:#9ab;
}
html,body{height:100%;margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,'Helvetica Neue',Arial;
  color:#eee;background:var(--bg);transition:background .3s;overflow:hidden}
.container{max-width:1200px;margin:18px auto;padding:18px;height:calc(100% - 36px);box-sizing:border-box;display:flex;flex-direction:column}
header{display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:10px}
header h1{margin:0;font-size:28px;letter-spacing:0.4px}
.controls{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
button{background:transparent;border:1px solid rgba(255,255,255,.12);padding:8px 12px;border-radius:10px;color:inherit;cursor:pointer;transition:.15s}
button:hover{background:rgba(255,255,255,.06)}
button.active{background:var(--accent);color:#071018;font-weight:700}
nav#years,nav#months{display:flex;flex-wrap:wrap;gap:8px;margin-top:12px}
main.viewer{flex:1;background:var(--card);border-radius:12px;padding:12px;display:grid;grid-template-columns:1fr 360px;gap:12px;position:relative;transition:background .3s;overflow:hidden}
.stage{width:100%;height:100%;border-radius:8px;display:flex;align-items:center;justify-content:center;position:relative;overflow:hidden;background:linear-gradient(180deg,rgba(0,0,0,.06),rgba(0,0,0,.02))}
.stage img,.stage video{width:100%;height:100%;max-width:100%;max-height:100%;object-fit:contain;display:block;border-radius:6px;opacity:0;transition:opacity .6s ease}
.stage img.visible,.stage video.visible{opacity:1}
:fullscreen .stage img,:fullscreen .stage video{width:100vw;height:100vh;max-width:100vw;max-height:100vh;object-fit:contain}
.meta{position:absolute;left:12px;bottom:12px;background:rgba(0,0,0,.45);padding:6px 10px;border-radius:8px;font-size:13px;color:var(--muted);z-index:1001}
.age{position:absolute;right:12px;bottom:12px;background:rgba(0,0,0,.45);padding:6px 10px;border-radius:8px;font-size:13px;color:#ffd;z-index:1001}
.counter{position:absolute;left:12px;top:12px;background:rgba(0,0,0,.45);padding:6px 10px;border-radius:8px;font-size:13px;color:#fff;z-index:1001;display:none}
.progress{position:absolute;left:0;top:0;height:3px;width:0;background:var(--accent);z-index:1002;transition:width linear}
.thumbs{height:100%;overflow:auto;padding:6px;border-left:1px solid rgba(255,255,255,.06);display:flex;flex-direction:column;gap:8px}
.thumb{display:flex;gap:8px;align-items:center;padding:6px;border-radius:8px;cursor:pointer;position:relative}
.thumb:hover{background:rgba(255,255,255,.06)}
.thumb.active{background:rgba(255,255,255,.12)}
.thumb img,.thumb video{width:96px;height:68px;object-fit:cover;border-radius:6px}
.thumb .date{font-size:12px;color:var(--muted)}
.videoIcon{position:absolute;left:6px;bottom:6px;font-size:18px;color:#fff;text-shadow:0 0 4px #000;background:rgba(0,0,0,.4);border-radius:4px;padding:2px 4px;pointer-events:none}
.footer{margin-top:10px;color:var(--muted);font-size:13px;text-align:center}
.fsHud{position:fixed;right:12px;bottom:12px;display:none;gap:8px;z-index:2147483646;align-items:center}
.select{background:rgba(0,0,0,.45);border:1px solid rgba(255,255,255,.2);color:#fff;border-radius:8px;padding:6px}
.titulo-brilhante {
  font-size: 34px; /* o tamanho que est√°s a usar agora */
  letter-spacing: 0.5px;
  position: relative;
  display: inline-block;
  line-height: 1.25;
  padding-bottom: 4px;
  background: linear-gradient(90deg, #fff, #ffd6e8, #fff);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-size: 200% auto;
  animation: brilhoSuave 6s linear infinite;
  text-shadow: 0 0 8px rgba(255, 182, 217, 0.15);
}
/* t√≠tulo principal mais destacado e aproximado do topo */
header h1#headline {
  font-size: 44px;       /* antes era ~28px */
  margin-top: -13px;      /* sobe ligeiramente */
  line-height: 1.1;
}

header {
  margin-top: -20px;       /* aproxima o header do topo da p√°gina */
}
#subtitle {
  margin-top: 15px;
  font-size: 14px;
}

@keyframes brilhoSuave {
  0% { background-position: 200% center; }
  100% { background-position: -200% center; }
}
#langToggle {
  user-select: none;
  display: flex;
  align-items: center;
  gap: 4px;
  font-size: 20px;
}
/* ajustar posi√ß√£o dos anos e meses */
nav#years {
  margin-top: -6px;         /* sobe ligeiramente sem cortar */
  margin-bottom: 6px;       /* d√° espa√ßo antes dos meses */
}

nav#months {
  margin-top: 0;            /* alinha logo ap√≥s os anos */
  margin-bottom: 4px;       /* pequeno espa√ßo extra visual */
}

.arrow{position:fixed;top:50%;transform:translateY(-50%);font-size:42px;font-weight:400;color:rgba(255,255,255,.8);
  background:rgba(255,255,255,.05);border:1px solid rgba(255,255,255,.12);width:56px;height:56px;border-radius:50%;
  display:flex;align-items:center;justify-content:center;cursor:pointer;z-index:2147483647;transition:all .25s ease;
  box-shadow:0 0 10px rgba(0,0,0,.4);opacity:0;pointer-events:none}
.arrow:hover{background:rgba(255,255,255,.15);transform:translateY(-50%) scale(1.1);color:#fff}
.arrow.left{left:28px}.arrow.right{right:28px}
:fullscreen .arrow{display:flex;opacity:1;pointer-events:auto}
body.show-arrows .arrow{opacity:1;pointer-events:auto}
/* organiza√ß√£o dos controlos (duas linhas) */
/* painel de controlos com 3 linhas, tudo alinhado √† direita */
.controls {
  display: flex;
  flex-direction: column;
  align-items: flex-end;
  gap: 6px;
  margin-left: auto;
  text-align: right;
}

/* cada linha de controlos */
.controls-row {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  justify-content: flex-end;
  align-items: center;
}

/* garante que tudo se alinha visualmente */
.controls-row label,
.controls-row select,
.controls-row button,
#langToggle {
  vertical-align: middle;
}

/* pequeno ajuste nos tamanhos */
.controls-row select {
  min-width: 90px;
}

/* espa√ßamento extra entre linhas */
.controls-row + .controls-row {
  margin-top: 4px;
}

/* opcional: painel transl√∫cido para destacar controlos */
.controls {
  background: rgba(255,255,255,0.03);
  padding: 8px 10px;
  border-radius: 10px;
  backdrop-filter: blur(6px);
}

/* üëá deixa este exatamente a seguir */
@media(max-width:900px){
  main.viewer{grid-template-columns:1fr}
  .thumbs{order:2;border-left:none;border-top:1px solid rgba(255,255,255,.06);height:160px;display:flex;overflow-x:auto;flex-direction:row}
}

@media(max-width:900px){
  main.viewer{grid-template-columns:1fr}
  .thumbs{order:2;border-left:none;border-top:1px solid rgba(255,255,255,.06);height:160px;display:flex;overflow-x:auto;flex-direction:row}
}
:fullscreen header,:fullscreen nav#years,:fullscreen nav#months,:fullscreen .thumbs{display:none!important}
:fullscreen main.viewer{grid-template-columns:1fr}
</style>
</head>
<body>
<div class="container">
  <header>
    <div>
      <h1 id="headline" class="titulo-brilhante">Mem√≥rias</h1>
      <div id="subtitle" style="font-size:13px;color:var(--muted)"></div>
    </div>
<div class="controls">

  <!-- linha 1 -->
  <div class="controls-row">
    <button id="fullscreen">Fullscreen</button>
    <button id="slideshow">Iniciar slideshow</button>
    <label style="display:flex;align-items:center;gap:6px">
      <span id="speedLbl">Velocidade</span>
      <select id="speed" class="select">
        <option value="2000">2s</option>
        <option value="4000" selected>4s</option>
        <option value="8000">8s</option>
        <option value="15000">15s</option>
      </select>
    </label>
  </div>

  <!-- linha 2 -->
  <div class="controls-row">
    <label style="display:flex;align-items:center;gap:6px">
      <span id="themeLbl">Tema</span>
      <select id="theme" class="select">
        <option value="dark">Escuro</option>
        <option value="pink">Rosa</option>
        <option value="sky">Azul C√©u</option>
      </select>
    </label>
    <label style="display:flex;align-items:center;gap:6px">
      <span id="gradLbl">Gradiente</span>
      <select id="grad" class="select">
        <option value="pink" selected>Rosa</option>
        <option value="blue">Azul</option>
        <option value="gold">Dourado</option>
        <option value="lilac">Lil√°s</option>
        <option value="aqua">Verde-√Ågua</option>
      </select>
    </label>
  </div>

  <!-- linha 3 -->
  <div class="controls-row">
    <div id="langToggle" style="cursor:pointer;font-size:20px;line-height:1.2">üáµüáπ / üá¨üáß</div>
    <button id="saveTheme" title="Guardar todas as prefer√™ncias">üíæ</button>
  </div>

</div>


  </header>

  <nav id="years"></nav>
  <nav id="months"></nav>

  <main class="viewer">
    <section class="stage" id="stage">
      <div id="ph" style="color:var(--muted)">üëã Escolhe um ano e m√™s para come√ßar.</div>
      <div class="progress" id="bar"></div>
      <div class="counter" id="counter"></div>
      <div class="meta" id="meta" style="display:none"></div>
      <div class="age" id="age" style="display:none"></div>
    </section>
    <aside class="thumbs" id="thumbs"></aside>
  </main>

  <div class="footer" id="footerLine"></div>
</div>

<div class="fsHud" id="fsHud">
  <button id="fsToggle">Iniciar slideshow</button>
  <label style="display:flex;align-items:center;gap:6px">
    <span id="fsSpeedLbl">Velocidade</span>
    <select id="fsSpeed" class="select">
      <option value="2000">2s</option>
      <option value="4000" selected>4s</option>
      <option value="8000">8s</option>
      <option value="15000">15s</option>
    </select>
  </label>
  <button id="fsExit">Sair</button>
</div>

<div class="arrow left" id="arrowLeft">‚Äπ</div>
<div class="arrow right" id="arrowRight">‚Ä∫</div>

<script>

<!--CONFIG-->
<!--MANIFEST-->

// === i18n ===
const STR = {
  pt:{
    choose:"üëã Escolhe um ano e m√™s para come√ßar.",
    speed:"Velocidade", theme:"Tema",
    start:"Iniciar slideshow (space)", stop:"Parar slideshow (space)",
    exit:"Sair", years:"Anos", months:"Meses",
    by:"Feito por", donate:"Doa√ß√µes",
    project:"Projeto", fs:"Fullscreen (F)"
  },
  en:{
    choose:"üëã Pick a year and month to begin.",
    speed:"Speed", theme:"Theme",
    start:"Start slideshow (space)", stop:"Stop slideshow (space)",
    exit:"Exit", years:"Years", months:"Months",
    by:"Made by", donate:"Donations",
    project:"Project", fs:"Fullscreen (F)"
  }
};

document.title = CONFIG?.pageTitle || "Offline Photo Album";
const BIRTHDATE = (CONFIG?.birthdate||"").trim();

// themes
const themes={
  dark:{bg:"#0f1115",card:"#0b0d10",muted:"#9aa0a6",accent:"#9ab"},
  pink:{bg:"#1a0b12",card:"#2a0f1c",muted:"#f7a7c0",accent:"#ffb6d9"},
  sky :{bg:"#0d1b24",card:"#132634",muted:"#a3d0f4",accent:"#6cf"}
};

const yearsEl=document.getElementById('years'),
      monthsEl=document.getElementById('months'),
      thumbsEl=document.getElementById('thumbs'),
      stage=document.getElementById('stage'),
      metaEl=document.getElementById('meta'),
      ageEl=document.getElementById('age'),
      bar=document.getElementById('bar'),
      counterEl=document.getElementById('counter'),
      ph=document.getElementById('ph'),
      speedSel=document.getElementById('speed'),
      fsSpeed=document.getElementById('fsSpeed'),
      fsHud=document.getElementById('fsHud'),
      fsToggle=document.getElementById('fsToggle'),
      themeSel=document.getElementById('theme'),
      saveTheme=document.getElementById('saveTheme'),
      grad=document.getElementById('grad'),
      langToggle=document.getElementById('langToggle');

let flatList=[],curIdx=0,timer=null,slideMs=+speedSel.value;
let Lang = (localStorage.getItem('album_lang')||CONFIG.language||'pt');

function applyTheme(name){
  const t = themes[name] || themes.dark;
  for(const k in t) document.documentElement.style.setProperty(`--${k}`, t[k]);
  themeSel.value = name;
}
function saveThemePref(){
  localStorage.setItem('album_theme', themeSel.value);
}

// === gradiente animado din√¢mico ===
function applyGradient(name) {
  const headline = document.querySelector('.titulo-brilhante');
  const map = {
    pink:  'linear-gradient(90deg,#fff,#ffd6e8,#fff)',
    blue:  'linear-gradient(90deg,#fff,#aee3ff,#fff)',
    gold:  'linear-gradient(90deg,#fff8dc,#ffd700,#fff8dc)',
    lilac: 'linear-gradient(90deg,#fff,#d6c2ff,#fff)',
    aqua:  'linear-gradient(90deg,#fff,#a9fff7,#fff)'
  };
  headline.style.background = map[name] || map.pink;
  headline.style.webkitBackgroundClip = 'text';
  headline.style.webkitTextFillColor = 'transparent';
  headline.style.backgroundSize = '200% auto';
  headline.style.animation = 'brilhoSuave 6s linear infinite';
  localStorage.setItem('album_gradient', name);
}

function setTexts(){
  const T=STR[Lang]||STR.pt;
  document.getElementById('speedLbl').textContent=T.speed;
  document.getElementById('fsSpeedLbl').textContent=T.speed;
  document.getElementById('themeLbl').textContent=T.theme;
  document.getElementById('fullscreen').textContent=T.fs;
  document.getElementById('slideshow').textContent=timer?T.stop:T.start;
  fsToggle.textContent=timer?T.stop:T.start;
  ph.textContent=T.choose;

const by = `${T.by} ${CONFIG.author} ‚Ä¢ ${CONFIG.projectName}` +
           (CONFIG.donateURL? ` ‚Ä¢ ${T.donate}: ${CONFIG.donateURL}` : '');
  document.getElementById('footerLine').textContent=by;
}

function monthOrder(a, b) {
  const meses = [
    // Portugu√™s
    "janeiro","fevereiro","marco","abril","maio","junho",
    "julho","agosto","setembro","outubro","novembro","dezembro",
    // Ingl√™s
    "january","february","march","april","may","june",
    "july","august","september","october","november","december"
  ];

  // Normaliza (remove acentos e p√µe em min√∫sculas)
  const norm = s => s.toLowerCase()
    .normalize("NFD")
    .replace(/[\u0300-\u036f]/g, "");

  const ai = meses.indexOf(norm(a));
  const bi = meses.indexOf(norm(b));

  if (ai !== -1 && bi !== -1) return ai - bi; // ambos reconhecidos
  if (ai !== -1) return -1;                   // s√≥ A reconhecido
  if (bi !== -1) return 1;                    // s√≥ B reconhecido
  return a.localeCompare(b, "pt", { numeric: true });
}

function fmtDate(iso){
  const p=iso.split('-'); const d=new Date(p[0],p[1]-1,p[2]);
  return isNaN(d)? iso : d.toLocaleDateString(Lang==='pt'?'pt-PT':'en-GB',{day:'2-digit',month:'long',year:'numeric'});
}
function ageStr(iso){
  if(!BIRTHDATE) return '';
  const p=iso.split('-'); const d=new Date(p[0],p[1]-1,p[2]);
  if(isNaN(d))return'';
  const bd = new Date(BIRTHDATE);
  if(isNaN(bd)) return '';
  if(d<bd) return '';
  let y=d.getFullYear()-bd.getFullYear();
  let m=d.getMonth()-bd.getMonth();
  if(d.getDate()<bd.getDate()) m--;
  if(m<0){ y--; m+=12; }
  if(y===0 && m===0){
    const diffDays = Math.floor((d - bd)/86400000);
    return (Lang==='pt') ? `${diffDays} dia${diffDays!==1?'s':''}` : `${diffDays} day${diffDays!==1?'s':''}`;
  }
  if(y===0) return (Lang==='pt') ? (m===1?'1 m√™s':`${m} meses`) : (m===1?'1 month':`${m} months`);
  if(m===0) return (Lang==='pt') ? `${y} ano${y!==1?'s':''}` : `${y} year${y!==1?'s':''}`;
  if(m===1) return (Lang==='pt') ? `${y} ano${y!==1?'s':''} e 1 m√™s` : `${y} year${y!==1?'s':''} and 1 month`;
  return (Lang==='pt') ? `${y} ano${y!==1?'s':''} e ${m} meses` : `${y} year${y!==1?'s':''} and ${m} months`;
}

function buildFlat(){
  flatList=[];
  Object.keys(manifest).sort((a,b)=>a-b).forEach(y=>{
    Object.keys(manifest[y]).sort(monthOrder).forEach(m=>{
      manifest[y][m].slice().sort((a,b)=>new Date(a.date)-new Date(b.date)).forEach(it=>{
        flatList.push({
          year:y, month:m, name:it.name, date:it.date,
          src: it.path
        });
      });
    });
  });
}


function renderYears(){
  yearsEl.innerHTML='';
  Object.keys(manifest).sort((a,b)=>a-b).forEach(y=>{
    const btn=document.createElement('button');
    btn.textContent=y;
    btn.onclick=()=>{
      document.querySelectorAll('#years button').forEach(b=>b.classList.remove('active'));
      btn.classList.add('active'); renderMonths(y);
    };
    yearsEl.appendChild(btn);
  });
}

function capitalizeFirst(str) {
  if (!str) return '';
  return str.charAt(0).toUpperCase() + str.slice(1);
}

function renderMonths(y){
  monthsEl.innerHTML='';
  const months=Object.keys(manifest[y]).sort(monthOrder);

  // Put "Ecografias" first if present
  const idxEco = months.findIndex(m=>m.toLowerCase()==='ecografias');
  if(idxEco!==-1){ months.splice(idxEco,1); months.unshift('Ecografias'); }

  months.forEach(m=>{
    const btn=document.createElement('button'); btn.textContent = capitalizeFirst(m);
    btn.onclick=()=>{
      document.querySelectorAll('#months button').forEach(b=>b.classList.remove('active'));
      btn.classList.add('active'); renderThumbs(y,m);
    };
    monthsEl.appendChild(btn);
  });
}

function renderThumbs(y,m){
  thumbsEl.innerHTML='';
  const list=manifest[y][m].slice().sort((a,b)=>new Date(a.date)-new Date(b.date));
  if(m.toLowerCase()==='ecografias'){
    let currentDateGroup='';
    list.forEach(it=>{
      const dateLabel=fmtDate(it.date);
      if(dateLabel!==currentDateGroup){
        currentDateGroup=dateLabel;
        const sep=document.createElement('div');
        sep.textContent='üìÖ '+dateLabel;
        sep.style='margin:8px 0 4px;color:var(--accent);font-weight:600;';
        thumbsEl.appendChild(sep);
      }
      addThumbCard(y,m,it);
    });
    return;
  }
  list.forEach(it=>addThumbCard(y,m,it));
}
function addThumbCard(y,m,it){
  const card=document.createElement('div'); card.className='thumb';
  const ext=it.name.split('.').pop().toLowerCase();
  const el=['mp4','mov','webm'].includes(ext)?document.createElement('video'):document.createElement('img');
  el.src = it.path;
  if(el.tagName==='IMG') el.loading='lazy';
  if(el.tagName==='VIDEO') el.muted=true;
  card.appendChild(el);
  if(el.tagName==='VIDEO'){const icon=document.createElement('div');icon.className='videoIcon';icon.textContent='üé¨';card.appendChild(icon);}
  const d=document.createElement('div'); d.className='date'; d.textContent=fmtDate(it.date); card.appendChild(d);
  card.onclick=()=>{
    const idx=flatList.findIndex(x=>x.year===y&&x.month===m&&x.name===it.name);
    if(idx>-1) show(idx);
  };
  thumbsEl.appendChild(card);
}

function show(i){
  if(flatList.length===0) return;
  if(i<0) i=flatList.length-1; if(i>=flatList.length) i=0; curIdx=i;
  const it=flatList[i];

  stage.querySelectorAll('img,video').forEach(n=>n.remove());
  if(ph) ph.style.display='none';

  const ext=it.name.split('.').pop().toLowerCase();
  const el=['mp4','mov','webm'].includes(ext)?document.createElement('video'):document.createElement('img');
  el.src = it.src;

  if (el.tagName === 'VIDEO') {
    el.controls = true; el.playsInline = true; el.preload = "metadata"; el.muted = false; el.autoplay = true;
    const wasRunning = !!timer; if (wasRunning) stopSS();
    el.oncanplay = ()=>{ el.controls = true; };
    el.onended = ()=>{ if (wasRunning) startSS(); };
  }

  el.onload=()=>el.classList.add('visible');
  el.onloadeddata=()=>el.classList.add('visible');

  stage.appendChild(el);
  metaEl.style.display='block'; metaEl.textContent=fmtDate(it.date);

  const a = ageStr(it.date);
  ageEl.style.display = a ? 'block':'none';
  ageEl.textContent = a ? ((Lang==='pt')?'üçº ':'üçº ')+a : '';

  const currentMonthList=flatList.filter(x=>x.year===it.year&&x.month===it.month);
  const pos=currentMonthList.findIndex(x=>x.name===it.name)+1;
  counterEl.style.display='block';
  counterEl.textContent=`${pos}/${currentMonthList.length}`;

  [...document.querySelectorAll('.thumb')].forEach(t=>t.classList.remove('active'));
  const tsel=[...document.querySelectorAll('.thumb img,.thumb video')]
      .find(e=>decodeURIComponent(e.src).endsWith(`/${it.name}`));
  if(tsel) tsel.parentElement.classList.add('active');

  resetBar();
}

function next(){show(curIdx+1);} function prev(){show(curIdx-1);}
function resetBar(){
  bar.style.transition='none'; bar.style.width='0%'; void bar.offsetWidth;
  if(timer){ bar.style.transition=`width ${slideMs}ms linear`; setTimeout(()=>bar.style.width='100%',20); }
}
function startSS(){
  if(timer) return;
  slideMs=+speedSel.value||+fsSpeed.value||4000;
  timer=setInterval(()=>{ next(); resetBar(); }, slideMs);
  const T=STR[Lang]||STR.pt;
  document.getElementById('slideshow').classList.add('active');
  document.getElementById('slideshow').textContent=T.stop;
  fsToggle.textContent=T.stop;
  resetBar();
}
function stopSS(){
  if(!timer) return;
  clearInterval(timer); timer=null; bar.style.width='0%';
  const T=STR[Lang]||STR.pt;
  document.getElementById('slideshow').classList.remove('active');
  document.getElementById('slideshow').textContent=T.start;
  fsToggle.textContent=T.start;
}
function toggleSS(){ timer?stopSS():startSS(); }

document.getElementById('slideshow').onclick=toggleSS;
speedSel.onchange=()=>{ if(timer){ stopSS(); startSS(); } };
fsSpeed.onchange=()=>{ if(timer){ stopSS(); startSS(); } };

document.getElementById('fullscreen').onclick=()=>{
  if(!document.fullscreenElement) document.documentElement.requestFullscreen();
  else document.exitFullscreen();
};
document.addEventListener('fullscreenchange',()=>{ fsHud.style.display=document.fullscreenElement?'flex':'none'; });
document.getElementById('fsExit').onclick=()=>{ if(document.fullscreenElement) document.exitFullscreen(); };
fsToggle.onclick=toggleSS;
document.getElementById('arrowLeft').onclick=prev;
document.getElementById('arrowRight').onclick=next;

document.addEventListener('keydown',e=>{
  if(e.key==='ArrowRight') next();
  else if(e.key==='ArrowLeft') prev();
  else if(e.key===' '){ e.preventDefault(); toggleSS(); }
  else if(e.key.toLowerCase()==='f'){
    if(!document.fullscreenElement) document.documentElement.requestFullscreen();
    else document.exitFullscreen();
  }
});

// show arrows on move
let arrowTimer;
document.addEventListener('mousemove',()=>{
  document.body.classList.add('show-arrows');
  clearTimeout(arrowTimer);
  arrowTimer=setTimeout(()=>{document.body.classList.remove('show-arrows');},1800);
});
document.addEventListener('keydown',e=>{
  if(['ArrowLeft','ArrowRight'].includes(e.key)){
    document.body.classList.add('show-arrows');
    clearTimeout(arrowTimer);
    arrowTimer=setTimeout(()=>{document.body.classList.remove('show-arrows');},1800);
  }
});

// === inicializa√ß√£o ===
function init() {
  // headline/subtitle
  document.getElementById('headline').textContent = CONFIG.displayName || 'Mem√≥rias';
  document.getElementById('subtitle').textContent = CONFIG.projectName || 'Offline Photo Album';

  // tema do localStorage ou do config
  applyTheme(localStorage.getItem('album_theme') || CONFIG.theme || 'dark');
  themeSel.onchange = (e) => applyTheme(e.target.value);

  // aplicar gradiente escolhido ou padr√£o
  applyGradient(localStorage.getItem('album_gradient') || 'pink');
  grad.onchange = (e) => applyGradient(e.target.value);

  // guardar tema/prefer√™ncias
  saveTheme.onclick = () => { 
    saveThemePref(); 
    saveTheme.textContent = '‚úÖ'; 
    setTimeout(() => saveTheme.textContent = 'üíæ', 900); 
  };

  // --- alternar idioma com bandeiras ---
  langToggle.onclick = () => {
    Lang = (Lang === 'pt' ? 'en' : 'pt');
    localStorage.setItem('album_lang', Lang);
    langToggle.textContent = (Lang === 'pt') ? 'üáµüáπ / üá¨üáß' : 'üá¨üáß / üáµüáπ';
    langToggle.title = (Lang === 'pt') ? 'Mudar para ingl√™s' : 'Switch to Portuguese';
    setTexts();
  };

  // inicializar com bandeira e t√≠tulo corretos
  langToggle.textContent = (Lang === 'pt') ? 'üáµüáπ / üá¨üáß' : 'üá¨üáß / üáµüáπ';
  langToggle.title = (Lang === 'pt') ? 'Mudar para ingl√™s' : 'Switch to Portuguese';

  // textos
  setTexts();

  // build principal
  if (typeof manifest === 'undefined') {
    stage.innerHTML = '<div style="color:#bbb">Erro: manifest n√£o encontrado.</div>';
    return;
  }

  buildFlat(); 
  renderYears();
}

// executa assim que carrega
init();

// Expor ao global para poderes chamar no console
window.renderYears = renderYears;
window.buildFlat   = buildFlat;
window.init        = init;
</script>

</body>
</html>
